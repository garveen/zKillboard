{% extends 'base.html' %}

{% if killdata.victim.characterID != 0 %}
	{% set victim = killdata.victim.characterName %}
{% else %}
	{% set victim = killdata.victim.corporationName %}
{% endif %}
{% set pageTitle = killdata.victim.shipName ~ ' | ' ~ victim ~ ' | Killmail' %}
{% block title %}{% include 'components/title.html' %}{% endblock %}

{% set description = victim ~ " lost their " ~ killdata.victim.shipName ~ " worth " ~ (extra.totalisk)|number_format(2, '.', ',') ~ " ISK." %}
{% set canonical = fullsiteurl ~ "/kill/" ~ killdata.info.killID ~ "/" %}

{% block header %}

{% if message %}
<div class="alert">
	<a class="close" data-dismiss="alert" href="#" aria-hidden="true">&times;</a>
	{{ message }}
</div>
{% endif %}
{% set showImage = true %}
{% endblock %}

{% block content %}
{% include 'components/partial_title.html' %}
<div class="navbar navbar-default">
	<div class="navbar-header hidden-xs">
		<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		</button>
	</div>
	<div id="details-menu" class="collapse navbar-collapse navbar-sub">
		<ul class="nav navbar-nav hidden-xs">
			{% if extra.prevKillID %}
			<li class="hidden-xs"><a href="/kill/{{ extra.prevKillID }}/">&lt;</a></li>
			{% endif %}
		</ul>
		<ul class="nav navbar-nav pull-right">
			{% if killdata.info.killID < 0 %}
			<li><a data-toggle="modal" data-target="#report" href="#">Report ({{ extra.reports }})</a></li>
			{% endif %}
			<li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown">External <b class="caret"></b></i></a>
				<ul class="dropdown-menu">
					<li class="dropdown-header">DOTLAN</li>
					<li><a href="https://evemaps.dotlan.net/system/{{ killdata.info.system.solarSystemName|url_encode }}" target="_blank" rel="noopener noreferrer">{{ killdata.info.system.solarSystemName }}</a></li>
					<li><a href="https://evemaps.dotlan.net/region/{{ killdata.info.system.regionName|url_encode }}" target="_blank" rel="noopener noreferrer">{{ killdata.info.system.regionName }}</a></li>
					<li class="divider"></li>
					<li class="dropdown-header">EVEWho Char Info</li>
					<li><a href="https://evewho.com/character/{{ killdata.victim.characterID }}" target="_blank" rel="noopener noreferrer">{{ killdata.victim.characterName }}</a></li>
					<li><a href="https://evewho.com/character/{{ finalBlow.characterID }}" target="_blank" rel="noopener noreferrer">{{ finalBlow.characterName }}</a></li>
					<li><a href="https://evewho.com/character/{{ topDamage.characterID }}" target="_blank" rel="noopener noreferrer">{{ topDamage.characterName }}</a></li>
				</ul>
			</li>
			<li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown">Export <b class="caret"></b></a>
				<ul class="dropdown-menu">
                    <li><a href='#' onClick="saveFitting({{ extra.crest.killID }}); return false;" rel="nofollow">Import Fit via ESI</a></li>
					<li><a data-toggle="modal" data-target="#DNA" href="#">DNA</a></li>
					<li><a data-toggle="modal" data-target="#EFT" href="#">EFT</a></li>
                    <li><a target="_blank" rel="noopener noreferrer" href="/kill/{{ extra.crest.killID }}/redirect/esi/">ESI Link</a></li>
                    <li><a data-toggle="modal" data-target="#ingamelink" href="#" onclick='$("#ingamelink").modal(); $("#ingamelinkcontent").html(`<iframe src="https://zkillboard.com/kill/{{ killdata.info.killID }}/ingamelink/" width="100%" rows="3" title="In Game Link"></iframe>`);'>In Game Link</a></li>
				</ul>
			</li>
			<li class="dropdown">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown">Social <b class="caret"></b></i></a>
				<ul class="dropdown-menu">
					<li><a href="https://www.facebook.com/sharer/sharer.php?u={{url}}" target="_blank" rel="noopener noreferrer"><img src="//{{ siteurl }}/img/social/fb_1.png"> Facebook</a></li>
					<li><a href="https://x.com/intent/tweet?text={{ pageTitle|url_encode }}&url={{url}}" target="_blank" rel="noopener noreferrer"><img src="//{{ siteurl }}/img/social/twitter_1.png"> X / Twitter</a></li>
					<li><a href="https://www.reddit.com/submit?url={{url}}&title={{ pageTitle|url_encode }}" target="_blank" rel="noopener noreferrer"><img src="//{{ siteurl }}/img/social/reddit.png"> Reddit</a></li>
				</ul>
			</li>
			<li><a href="/related/{{ killdata.info.system.solarSystemID }}/{{ extra.relatedtime }}/">Related</a></li>
			{% if extra.nextKillID %}
			<li class="hidden-xs"><a href="/kill/{{ extra.nextKillID }}/">&gt;</a></li>
			{% endif %}
		</ul>
	</div>
</div>

{% if pageview == "overview" %}
<div class="col-lg-8" style="padding-left: 0px;">
	<table class="hidden-xs" style="background-color:transparent;">
		<tr>
			<td style="padding: 0px; vertical-align: top;">{% include 'components/fitting_wheel.html' %}</td>
			<td style="width: 100%;" valign="top">{% include 'components/victim_info.html' %}</td>
		<tr>
	</table>
	<div class="row visible-xs" style="padding: 0px;">
		<div class="col-lg-5" style="padding: 0px;"  id="fittingwheeldiv">{% include 'components/fitting_wheel.html' %}</div>
        <br class="d-lg-none" />
		<div class="col-lg-5" style="padding: 0px;">{% include 'components/victim_info.html' %}</div>
	</div>
	<div class="row">
		<div>{% include 'components/item_list.html' %}</div>
	</div>
</div>

<div class="col-lg-4">
	<center>
<a id='loginsideimage' href='/ccpoauth2/' class='btn btn-block collapse'><img src='/img/ssologin.png' style='width: 209px;'><br/><br/></a>

	</center>

	{% if sponsoredMessage %}
	<div style="display: flex;">
		<div style='max-width: 200px; height: 240px; text-decoration: none;'>{{ sponsoredMessage|raw }}</div>
		<div style='max-width: 180px; text-decoration: none;  border-radius: 1em; border-radius: 1em; padding-left: 1em;'>
			<center>
			<div style='background-color: #1D232A; color: white; border-radius: 1em;'>
				<a href='https://store.eveonline.com/' target='_new' style='height: 230px; color: white; border: 0px; margin: 0px; padding: 0px;' class='btn'>
				<h3>Eve Store</h3>
				<h4>OMEGA SKINs PLEX</h4>
				<br/>
				<svg width="130" height="55" viewbox="0 0 130 55" fill="none" xmlns="http://www.w3.org/2000/svg" class="Header_logo___CXuk">
					<path d="M0 20.8012H39.7595V13.7632H0V20.8012ZM0 10.1847H7.18686C7.18686 10.1847 7.18686 8.4244 7.18686 7.76909C8.20031 7.76909 39.7595 7.76909 39.7595 7.76909V0.724609H0V10.1847ZM7.18686 24.3476H0V33.8334H39.7595V26.7921C39.7595 26.7921 8.20031 26.7921 7.18686 26.7921C7.18686 26.1336 7.18686 24.3476 7.18686 24.3476ZM97.4212 24.3476H90.2374V33.8334H129.994V26.7921C129.994 26.7921 98.4316 26.7921 97.4181 26.7921C97.4212 26.1336 97.4212 24.3476 97.4212 24.3476ZM65.0062 26.0372C64.1534 24.5018 50.9445 0.724609 50.9445 0.724609H43.1273L65.0062 40.3061L86.8696 0.724609H79.0462C79.0462 0.724609 65.8559 24.5018 65.0062 26.0372ZM90.2405 0.724609V10.1847H97.4243C97.4243 10.1847 97.4243 8.4244 97.4243 7.76909C98.4378 7.76909 130 7.76909 130 7.76909V0.724609H90.2405ZM90.2405 20.8012H129.997V13.7632H90.2405V20.8012Z" fill="white"></path>
					<path d="M26.1796 49.6175C26.1796 49.0682 26.2784 48.6924 26.4793 48.4868C26.677 48.2844 27.0602 48.1816 27.6287 48.1816H31.9204C32.492 48.1816 32.8782 48.2812 33.0791 48.4868C33.2768 48.6892 33.3788 49.065 33.3788 49.6175V52.8298C33.3788 53.3887 33.2768 53.7678 33.0791 53.9669C32.8782 54.1693 32.492 54.2721 31.9204 54.2721H27.6318C27.0602 54.2721 26.6801 54.1725 26.4824 53.9669C26.2815 53.7678 26.1827 53.3887 26.1827 52.8298V49.6175H26.1796ZM27.5422 53.1253H32.0193V49.2674H27.5422V53.1253Z" fill="white"></path>
					<path d="M42.1776 54.2695V48.1855H43.1076L47.2325 51.7736C47.3716 51.8957 47.4982 52.0049 47.6033 52.1077C47.7114 52.2169 47.8103 52.3229 47.8999 52.4321C47.8783 52.0949 47.8628 51.8507 47.8567 51.7094C47.8505 51.5648 47.8443 51.4556 47.8443 51.3785V48.1855H49.0648V54.2728H48.1347L43.8337 50.5112C43.7287 50.4148 43.6391 50.3281 43.5618 50.251C43.4846 50.1739 43.4135 50.0968 43.3456 50.0133C43.3641 50.2028 43.3765 50.3795 43.3888 50.5466C43.395 50.7136 43.3981 50.8581 43.3981 50.9802V54.2695H42.1776Z" fill="white"></path>
					<path d="M57.9921 54.2696V48.1855H59.3547V53.126H63.7453V54.2696H57.9921Z" fill="white"></path>
					<path d="M71.6794 54.2695V48.1855H73.042V54.2728H71.6794V54.2695Z" fill="white"></path>
					<path d="M81.9626 54.2695V48.1855H82.8958L87.0206 51.7736C87.1628 51.8957 87.2864 52.0049 87.3945 52.1077C87.5026 52.2169 87.6015 52.3229 87.688 52.4321C87.6664 52.0949 87.651 51.8507 87.6448 51.7094C87.6355 51.5648 87.6324 51.4556 87.6324 51.3785V48.1855H88.8498V54.2728H87.9198L83.6188 50.5112C83.5137 50.4148 83.4241 50.3281 83.3438 50.251C83.2696 50.1739 83.1955 50.0968 83.1306 50.0133C83.1491 50.2028 83.1646 50.3795 83.1708 50.5466C83.1831 50.7136 83.1862 50.8581 83.1862 50.9802V54.2695H81.9626Z" fill="white"></path>
					<path d="M97.7753 54.2696V48.1855H103.763V49.2231H99.141V50.5787H101.832V51.6162H99.141V53.1228H103.819V54.2664H97.7753V54.2696Z" fill="white"></path>
				</svg>
				<h5>use code zkill<br/>to support zkill<br/></h5>
				</a>
			</div>
			</center>
		</div>
	</div>
	{% endif %}

    <div class='alert alert-info'><center><a href='{{ referralLink }}' alt='1 million SP FREE'><img src='https://images.evetech.net/types/40520/icon?size=32' alt='1 million free skill points!'/>1 Million SP FREE</a></center></div>
	{% if extra.npcOnly %}
		<div class="alert alert-info">This is an NPC Only killmail.<br/>It is not counted in statistics.</div>
	{% endif %}
	{% if extra.atShip %}
		<center><div class="alert alert-success">AT Ship Involved</div></center>
	{% endif %}
        {% if 'padding' in killdata.info.labels %}
		    <div class="alert alert-warning"><center>Killboard Padding<br/>It is not counted in statistics.</center></div>
        {% else %}
		{% if killdata.info.solo %}
		<div class="alert alert-success"><center>Solo Killmail</center></div>
		{% endif %}
		{% if killdata.info.ganked %}
		<div class="alert alert-danger"><center>GANKED</center></div>
		{% endif %}
        {% endif %}
		<div class="tab-pane fade in active" id="details">
			{% if extra.warInfo.dscr %}
			<div>
				<table class="table table-condensed" style="margin: 0px; text-align: center;">
				<tr><th style='text-align: center;'>War</th></tr>
				<tr><td><a href="/war/{{ extra.warInfo.warID }}/">{{ extra.warInfo.dscr }}</a></td></tr>
				</table>
			</div>
			{% endif %}
			<div style='margin-bottom: 0.25em;'>{% include 'components/tdfb.html' %}</div>
			<div>
				<div style="margin: 0px;">{% include 'components/attackers.html' %}</div>
			</div>
			{% if extra.invAll | length %}
			<div style="margin: 0px;">{% set field = extra.invAll %}{% include 'components/involved_summary.html' %}</div>
			{% endif %}
			<!--<div><small>Kill Added: {{ extra.insertTime }}</small></div>-->
		</div>

<hr/>
<div id="commentblock"></div>
</div>


{% elseif pageview == "involved" %}
<table class="table table-condensed table-striped">
	<thead>
		<tr class="titles">
			<th colspan="2">Attacker</th>
			<th colspan="2">Equipment</th>
			<th>Damage</th>
		</tr>
	</thead>
	<tbody>
	{% set imageSize = 32 %}
	{% set resizeImage = 40 %}
	{% for attacker in killdata.involved %}
		<tr class="attacker">
			<td class="icons" style="vertical-align: middle; width: 200px;">
				{% set field = attacker %}
				{% include 'components/image_char.html' %}
				{% include 'components/image_corp.html' %}
				{% include 'components/image_alli.html' %}
				{% include 'components/image_faction.html' %}
			</td>
			<td class="pilot">
				<a href="/character/{{ attacker.characterID }}/">{{ attacker.characterName }}</a><br>
				<a href="/corporation/{{ attacker.corporationID }}/">{{ attacker.corporationName }}</a>
				{% if attacker.allianceID != 0 %} / <a href="/alliance/{{attacker.allianceID}}/">{{ attacker.allianceName }}</a>{% endif %}
				{% if attacker.factionID != 0 %} / <a href="/faction/{{attacker.factionID}}/">{{ attacker.factionName }}</a>{% endif %}
			</td>
			<td class="icons" style="width:100px;">
				{% include 'components/image_ship.html' %}
				{% include 'components/image_item.html' %}
			</td>
			<td class="equipment">
				<a href="/item/{{attacker.shipTypeID}}/">{{ attacker.shipName }}</a> <br>
				<a href="/item/{{attacker.weaponTypeID}}/">{{ attacker.weaponTypeName }}</a>
			</td>
			<td class="damage" style="vertical-align: middle;">{{ attacker.damage }}</td>
		</tr>
		{% endfor %}
	</tbody>
</table>
{% endif %}
{% endblock %}

{% block modal %}
<!-- modal -->
<div class="modal fade" id="report">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-content">
				<h4 class="modal-title">Report Mail</h4>
			</div>
			<div class="modal-body">
				{% if sessionusername %}
					<form name="report" method="post" action="/kill/{{ killdata.info.killID }}/">
						<div class="form-group">
							<textarea id="report" name="report" type="text" required placeholder="Report Reason" class="col-md-12" rows="12"></textarea>
						</div>
						<div class="form-group">
							<button type="submiut" class="btn btn-primary">Post Report</button>
						</div>
					</form>
				{% else %}
					<div class="alert alert-warning">Sorry, you are not logged in.</div>
				{% endif %}
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="DNA">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">DNA</h4>
			</div>
			<div class="modal-body">
				<form name="myform">
					<div class="form-group">
						<textarea onClick="this.select();" class="fitting col-md-12" rows="2" id="dna" name="dna">{{ extra.dnatext }}</textarea>
					</div>
					<div class="form-group">
						<a href="#" class="btn btn-primary" data-dismiss="modal">Close</a>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="EFT">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">EFT</h4>
			</div>
			<div class="modal-body">
				<form name="myform">
					<div class="form-group">
						<textarea onClick="this.select();" class="fitting col-md-12" rows="15" id="eft" name="eft" readonly="readonly">[{{ killdata.victim.shipName }}, {{ killdata.victim.characterName }}'s {{ killdata.victim.shipName }}]
{{ extra.efttext }}</textarea>
					</div>
					<div class="form-group">
						<a href="#" class="btn btn-primary" data-dismiss="modal">Close</a>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>


<div class="modal fade" id="ingamelink">
        <div class="modal-dialog">
                <div class="modal-content">
                        <div class="modal-header">
                                <h4 class="modal-title">Killmail - In Game Link</h4>
                        </div>
                        <div class="modal-body">
                                <form name="myform" class="form">
                                        <p>Must copy to in game notepad to create the link in game, then you can drag and copy that elsewhere. Human verification is in place because of scrapers slamming the site, sorry.</p>
                                        <div class="form-group">
                                            <div id='ingamelinkcontent'></div>
                                        </div>
                                        <div class="form-group">
                                                <a href="#" class="btn btn-primary" data-dismiss="modal">Close</a>
                                        </div>
                                </form>
                        </div>
                </div>
        </div>
</div>


{% endblock %}

{% block opengraph %}
	<meta name="twitter:title" content="{{ pageTitle }}">
    <meta name="twitter:image" content="https://images.evetech.net/types/{{ killdata.victim.shipTypeID }}/icon">
	<meta name="twitter:card" content="summary">
	<meta name="og:title" content="{{ pageTitle }}">
	<meta name="og:url" content="{{ fullsiteurl }}/kill/{{ killdata.info.killID }}/">
{% if finalBlow.characterName == NULL %}
	<meta name="twitter:description" content="{{ killdata.victim.characterName }} ({{ killdata.victim.corporationName}}) lost their {{ killdata.victim.shipName }} in {{ killdata.info.system.solarSystemName }} ({{ killdata.info.system.regionName }}) Total Value: {{ (extra.totalisk)|number_format(2, '.', ',')}} ISK">
	<meta name="og:description" content="{{ killdata.victim.characterName }} ({{ killdata.victim.corporationName}}) lost their {{ killdata.victim.shipName }} in {{ killdata.info.system.solarSystemName }} ({{ killdata.info.system.regionName }}) Total Value: {{ (extra.totalisk)|number_format(2, '.', ',')}} ISK">
{% else %}
	<meta name="twitter:description" content="{{ killdata.victim.characterName }} ({{ killdata.victim.corporationName}}) lost their {{ killdata.victim.shipName }} in {{ killdata.info.system.solarSystemName }} ({{ killdata.info.system.regionName }}). Final Blow by {{ finalBlow.characterName }} ({{ finalBlow.corporationName }}) flying {% if killdata.info.solo %}solo {% endif %}in a {{ finalBlow.shipName }}. Total Value: {{ (extra.totalisk)|number_format(2, '.', ',')}} ISK">
	<meta name="og:description" content="{{ killdata.victim.characterName }} ({{ killdata.victim.corporationName}}) lost their {{ killdata.victim.shipName }} in {{ killdata.info.system.solarSystemName }} ({{ killdata.info.system.regionName }}). Final Blow by {{ finalBlow.characterName }} ({{ finalBlow.corporationName }}) flying {% if killdata.info.solo %}solo {% endif %}in a {{ finalBlow.shipName }}. Total Value: {{ (extra.totalisk)|number_format(2, '.', ',')}} ISK">
{% endif %}
	<meta name="og:image" content="https://images.evetech.net/types/{{ killdata.victim.shipTypeID }}/icon">
{% endblock %}

{% block script %}
<script>
const killID = '{{ killdata.info.killID }}';
function prepComments() {
	if ($ == undefined) setTimeout(prepComments, 500);
	else {
    		$("#commentblock").load('/cache/bypass/comment/kill-{{ killdata.info.killID }}/-1/up/');
    		pubsub('comment:kill-{{ killdata.info.killID }}');
    	}
}
</script>
{% endblock %}
